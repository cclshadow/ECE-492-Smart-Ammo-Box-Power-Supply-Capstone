#!/bin/bash

echo "Starting I2C setup script..."

# Rename and make executable
echo "Setting up script permissions..."
mv "$0" setup_i2c.sh
chmod +x setup_i2c.sh

# Enable I2C in raspi-config
echo "Please run raspi-config and enable I2C:"
echo "1. Run: sudo raspi-config"
echo "2. Navigate to Interface Options -> I2C"
echo "3. Enable I2C"
echo "4. Reboot your Raspberry Pi"
echo "Press Enter when you've completed these steps..."
read

# After reboot, run these commands:
echo "Installing required packages..."
sudo apt-get update
sudo apt-get install -y i2c-tools python3-smbus2

# Add your user to the i2c group
echo "Adding user to i2c group..."
sudo usermod -aG i2c $USER
echo "Please log out and log back in for the group changes to take effect"
echo "Press Enter when you've logged back in..."
read

# Check I2C setup
echo "Checking I2C setup..."
lsmod | grep i2c
ls -l /dev/i2c*

# Run the I2C loopback test
echo "Running I2C loopback test..."
sudo python3 i2c_loopback.py 